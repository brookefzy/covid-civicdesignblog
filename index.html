<html lang='eng'>
    <head>
        <title>
            Covid Test in NYC
        </title>
        <script src = "https://d3js.org/d3.v5.min.js" charset="utf-8"></script>
        <!-- add a style here -->
        <style>
            body {
                position: absolute;
                font-family: "Proxima Nova", "Montserrat", sans-serif;
            }
            h1, h2 {
                position: absolute;
                left: 10px;
                font-size: 1.3em;
                font-weight: 100;
            }
            h2 {
                top: 30px;
                font-size: 1em;
            }
            /* REMOVEã€‚incident FILL CSS */
            /* .incident {
                fill: steelblue;
            } */
            .hover {
                fill: yellow;
            }

            /* ADD CSS FOR #sliderContainer */
            #sliderContainer{
                text-align: center;
                position: relative;
                top:600px
            }
        </style>


    </head>
    <body>
        <!-- page elemets and content go here. -->
        <h1>Covid Test in NYC</h1>
        <h2></h2>
        <div id="sliderContainer">
            <input id="timeslide" type="range" min="0" max="11" value="0" step="1"/><br>
            <span id="range">January</span>
        </div>


        <script>
            //2. Load the data url:
            var bosNeighborurl='data/ZIP_CODE_040114.geojson'

            // Load the rodent data url:
            var testurl="https://raw.githubusercontent.com/brookefzy/covid-civicdesignblog/master/data/blogdata_nyc.csv"

            // Global Variables
            // var inputValue = null;
            // var month = ["January","February","March","April","May","June","July","August",
            // "September","October","November","December"];

            //3.Create SVG canvas
            //Width and height of the whole visualization
            var width = 700
            var height = 580


            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", width)
                        .attr("height", height)

            //Append empty placeholder g element to the svg
            //g will contain geometry elements
            var g=svg.append("g")

            //4.Set Projection Parameters
            var albersProjection = d3.geoAlbers()
                .scale( 190000)
                .rotate([71.057, 0])
                .center([0, 42.313])
                .translate([width/2, height/2])

            //5.Create GeoPath function that uses built-in D3 functionality to turn
            //lat/lon coordinates into screen coordinates;
            var geoPath = d3.geoPath()
                .projection(albersProjection)


            //6. Load the data and bind data to svg canvas

            d3.json(bosNeighborurl).then(function(bosNeighbor){
                //6. Bind the data to svg canvas
                //Classic D3, select non-existent elements, bind the data, append the elements, and apply attributes
                console.log(bosNeighbor)

                g.selectAll("path")
                    .data(bosNeighbor.features)
                    .enter()
                    .append("path")
                    .attr("fill", "#ccc")
                    .attr("stroke", "#333")
                    .attr("d",geoPath)

            })

            // 7. add rodent data
            d3.csv(testurl).then(function(rodent){
                //
                console.log(rodent)
                var rodents = svg.append("g")
                rodents.selectAll("path")
                    .data(rodent.features)
                    .enter()
                    .append("path")
                    .attr("fill",initialDate)//replace original value with initialDate here
                    .attr("stroke","#999")
                    .attr("d", geoPath)
                    //apply style here
                    .attr( "class", "incident")
                    //add mouseover effects here:
                    .on("mouseover", function(d){
		                d3.select("h2").text(d.properties.LOCATION_STREET_NAME);
		                d3.select(this).attr("class","incident hover");
	                })
                    .on("mouseout", function(d){
                        d3.select("h2").text("");
                        d3.select(this).attr("class","incident");
                    });

            })
            // when the input range changes update the value
            d3.select("#timeslide").on("input", function() {
                update(+this.value);
            });

            // update the fill of each SVG of class "incident" with value
            function update(value) {
                document.getElementById("range").innerHTML=month[value];
                inputValue = month[value];
                d3.selectAll(".incident")
                    .attr("fill", dateMatch);
            }
            // function to match date
            function dateMatch(data, value) {
                var d = new Date(data.properties.OPEN_DT);
                var m = month[d.getMonth()];
                if (inputValue == m) {
                    this.parentElement.appendChild(this);
                    return "red";
                } else {
                    return "#999";
                };
            }

            //Set Initial State
            function initialDate(d,i){
                var d = new Date(d.properties.OPEN_DT);
                var m = month[d.getMonth()];
                if (m == "January") {
                    this.parentElement.appendChild(this);
                    return "red";
                } else {
                    return "#999";
                };
            }







        </script>
    </body>
</html>
